<div class="p-4 bg-gray-50 min-h-screen">
    <button (click)="navigate('customers')"
        class="mb-4 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg transition duration-200 flex items-center gap-2 hover:bg-gray-300">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"
            class="lucide lucide-chevron-left">
            <path d="m15 18-6-6 6-6" />
        </svg>
        Back to Customers
    </button>

    <ng-container *ngIf="customer; else customerNotFound">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">{{ customer.name }}</h1>

        <div class="bg-white p-6 rounded-xl shadow-md mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <p class="text-gray-600 flex items-center gap-2 text-base"><svg xmlns="http://www.w3.org/2000/svg"
                            width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"
                            strokeLinecap="round" strokeLinejoin="round" class="lucide lucide-map-pin">
                            <path d="M12 18.2v-2c-3.13-1-6-3.7-6-8.2a6 6 0 0 1 12 0c0 4.5-2.87 7.2-6 8.2Z" />
                            <circle cx="12" cy="10" r="3" />
                        </svg> {{ customer.address }}</p>
                </div>
                <div>
                    <p class="text-gray-600 flex items-center gap-2 text-base"><svg xmlns="http://www.w3.org/2000/svg"
                            width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"
                            strokeLinecap="round" strokeLinejoin="round" class="lucide lucide-phone">
                            <path
                                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-3.67-3.67A19.79 19.79 0 0 1 2 5.18V3a2 2 0 0 1 2-2h3.9a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />
                        </svg> {{ customer.phone }}</p>
                </div>
                <div>
                    <p class="text-gray-600 flex items-center gap-2 text-base"><svg xmlns="http://www.w3.org/2000/svg"
                            width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"
                            strokeLinecap="round" strokeLinejoin="round" class="lucide lucide-milk">
                            <path d="M8 2h8a2 2 0 0 1 2 2v2H6V4a2 2 0 0 1 2-2z" />
                            <path d="M19 6H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2z" />
                        </svg> {{ customer.milkType }} Milk</p>
                </div>
                <div>
                    <p class="text-gray-600 flex items-center gap-2 text-base"><svg xmlns="http://www.w3.org/2000/svg"
                            width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"
                            strokeLinecap="round" strokeLinejoin="round" class="lucide lucide-clock">
                            <circle cx="12" cy="12" r="10" />
                            <polyline points="12 6 12 12 16 14" />
                        </svg> {{ customer.litersMorning }}L (Morning), {{ customer.litersNoon }}L (Noon)</p>
                </div>
                <div>
                    <p class="text-gray-600 flex items-center gap-2 text-base"><svg xmlns="http://www.w3.org/2000/svg"
                            width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"
                            strokeLinecap="round" strokeLinejoin="round" class="lucide lucide-dollar-sign">
                            <line x1="12" y1="1" x2="12" y2="23" />
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                        </svg> â‚¹{{ customer.pricePerLiter }}/Liter</p>
                </div>
                <div>
                    <p class="text-gray-600 flex items-center gap-2 text-base"><svg xmlns="http://www.w3.org/2000/svg"
                            width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"
                            strokeLinecap="round" strokeLinejoin="round" class="lucide lucide-user-check">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                            <circle cx="9" cy="7" r="4" />
                            <polyline points="16 11 18 13 22 9" />
                        </svg> Status: <span
                            [ngClass]="{'font-medium text-green-600': customer.status === 'Active', 'font-medium text-red-600': customer.status === 'Paused'}">{{
                            customer.status }}</span></p>
                </div>
            </div>
            <div class="flex justify-end mt-4">
                <button (click)="navigate('add-edit-customer', customer.id)"
                    class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-blue-700 transition duration-200 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"
                        class="lucide lucide-edit">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                        <path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                    </svg>
                    Edit Info
                </button>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex border-b border-gray-200 mb-6">
                <button (click)="setActiveTab('dailyLog')"
                    class="px-6 py-3 text-center text-sm font-medium transition duration-200"
                    [ngClass]="{'border-b-2 border-blue-600 text-blue-600': activeTab === 'dailyLog', 'text-gray-500 hover:text-gray-700': activeTab !== 'dailyLog'}">
                    Daily Log
                </button>
                <button (click)="setActiveTab('billing')"
                    class="px-6 py-3 text-center text-sm font-medium transition duration-200"
                    [ngClass]="{'border-b-2 border-blue-600 text-blue-600': activeTab === 'billing', 'text-gray-500 hover:text-gray-700': activeTab !== 'billing'}">
                    Billing
                </button>
                <button (click)="setActiveTab('communication')"
                    class="px-6 py-3 text-center text-sm font-medium transition duration-200"
                    [ngClass]="{'border-b-2 border-blue-600 text-blue-600': activeTab === 'communication', 'text-gray-500 hover:text-gray-700': activeTab !== 'communication'}">
                    Communication
                </button>
            </div>

            <div class="tab-content">
                <ng-container *ngIf="activeTab === 'dailyLog'">
                    <h2 class="text-xl font-semibold mb-4">Daily Delivery Log</h2>
                    <ng-container *ngIf="customer.dailyLog && customer.dailyLog.length > 0; else noDailyLog">
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white rounded-lg shadow-sm overflow-hidden border-collapse">
                                <thead>
                                    <tr class="bg-gray-200">
                                        <th
                                            class="px-4 py-3 text-left text-sm font-medium text-gray-700 border-b border-gray-200">
                                            Date</th>
                                        <th
                                            class="px-4 py-3 text-left text-sm font-medium text-gray-700 border-b border-gray-200">
                                            Morning</th>
                                        <th
                                            class="px-4 py-3 text-left text-sm font-medium text-gray-700 border-b border-gray-200">
                                            Noon</th>
                                        <th
                                            class="px-4 py-3 text-left text-sm font-medium text-gray-700 border-b border-gray-200">
                                            Extra</th>
                                        <th
                                            class="px-4 py-3 text-left text-sm font-medium text-gray-700 border-b border-gray-200">
                                            Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let log of customer.dailyLog; let i = index">
                                        <td class="px-4 py-3 text-sm text-gray-800 border-b border-gray-200">{{ log.date
                                            }}</td>
                                        <td class="px-4 py-3 text-sm text-gray-800 border-b border-gray-200">{{
                                            log.morning }}L</td>
                                        <td class="px-4 py-3 text-sm text-gray-800 border-b border-gray-200">{{ log.noon
                                            }}L</td>
                                        <td class="px-4 py-3 text-sm text-gray-800 border-b border-gray-200">{{
                                            log.extra }}L</td>
                                        <td class="px-4 py-3 text-sm text-gray-800 border-b border-gray-200">{{
                                            log.total }}L</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </ng-container>
                    <ng-template #noDailyLog>
                        <p class="text-center text-gray-500">No daily log entries available.</p>
                    </ng-template>
                </ng-container>

                <ng-container *ngIf="activeTab === 'billing'">
                    <h2 class="text-xl font-semibold mb-4">Billing Information</h2>
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-600/20">
                        <p class="text-lg font-medium text-gray-700">Monthly Total Liters: <span class="font-bold">{{ monthlyTotalLiters }} L</span></p>
                        <p class="text-lg font-medium text-gray-700">Price per Liter: <span class="font-bold">â‚¹{{
                                customer.pricePerLiter }}</span></p>
                        <p class="text-2xl font-bold text-blue-700 mt-2">Total Amount Due: â‚¹{{
                            calculateBilling(customer.dailyLog || []) }}</p>
                        <div class="mt-4 flex flex-wrap gap-2 justify-end">
                            <button
                                class="bg-green-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-green-700 transition duration-200 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"
                                    strokeLinejoin="round" class="lucide lucide-file-text">
                                    <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9Z" />
                                    <path d="M18 2v6h6" />
                                    <path d="M10 12H8" />
                                    <path d="M16 16H8" />
                                    <path d="M16 20H8" />
                                </svg>
                                Generate Bill (PDF)
                            </button>
                            <button
                                class="bg-purple-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-purple-700 transition duration-200 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"
                                    strokeLinejoin="round" class="lucide lucide-send">
                                    <path d="m22 2-7 20-4-9-9-4 20-7z" />
                                    <path d="M22 2 11 13" />
                                </svg>
                                Send Bill
                            </button>
                            <button
                                class="bg-yellow-600 text-gray-800 px-4 py-2 rounded-lg shadow-md hover:bg-yellow-700 transition duration-200 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"
                                    strokeLinejoin="round" class="lucide lucide-check-circle">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                                    <path d="m9 11 3 3L22 4" />
                                </svg>
                                Mark as Paid
                            </button>
                        </div>
                    </div>
                </ng-container>

                <ng-container *ngIf="activeTab === 'communication'">
                    <h2 class="text-xl font-semibold mb-4">Communication History</h2>
                    <ng-container
                        *ngIf="customer.communications && customer.communications.length > 0; else noCommunication">
                        <div class="flex flex-col gap-4">
                            <div *ngFor="let comm of customer.communications; let i = index"
                                class="bg-gray-100 p-4 rounded-lg border border-gray-200">
                                <p class="text-sm text-gray-500 flex items-center gap-1">
                                    <ng-container *ngIf="comm.type === 'SMS'"><svg xmlns="http://www.w3.org/2000/svg"
                                            width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"
                                            class="lucide lucide-smartphone">
                                            <rect width="14" height="20" x="5" y="2" rx="2" ry="2" />
                                            <path d="M12 18h.01" />
                                        </svg></ng-container>
                                    <ng-container *ngIf="comm.type === 'Email'"><svg xmlns="http://www.w3.org/2000/svg"
                                            width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"
                                            class="lucide lucide-mail">
                                            <rect width="20" height="16" x="2" y="4" rx="2" />
                                            <path d="m22 7-10 7L2 7" />
                                        </svg></ng-container>
                                    {{ comm.type }} on {{ comm.date }}
                                </p>
                                <p class="text-gray-800 mt-1">{{ comm.message }}</p>
                            </div>
                        </div>
                    </ng-container>
                    <ng-template #noCommunication>
                        <p class="text-center text-gray-500">No communication history available.</p>
                    </ng-template>
                </ng-container>
            </div>
        </div>
    </ng-container>

    <ng-template #customerNotFound>
        <div class="p-4 bg-gray-50 min-h-screen flex flex-col items-center justify-center">
            <h1 class="text-2xl font-bold text-red-600 mb-4">Customer not found.</h1>
            <button (click)="navigate('customers')"
                class="bg-blue-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-blue-700 transition duration-200 flex items-center gap-2">
                Go to Customer List
            </button>
        </div>
    </ng-template>
</div>